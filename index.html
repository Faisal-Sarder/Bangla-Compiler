<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶á‡¶≤‡¶æ‡¶∞</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Noto Sans Bengali', sans-serif;
      padding: 40px 20px;
      background: #f4f6f9;
      color: #1a1a1a;
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background: #1a1a1a;
      color: #eaeaea;
    }

    .container {
      max-width: 950px;
      margin: 0 auto;
    }

    h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    h3 {
      font-size: 20px;
      margin-top: 30px;
      margin-bottom: 10px;
      border-left: 4px solid #007bff;
      padding-left: 10px;
      color: inherit;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 25px;
      font-size: 17px;
    }

    textarea {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      height: 160px;
      font-size: 15px;
      margin-top: 8px;
      padding: 12px 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fff;
      resize: vertical;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      transition: border-color 0.3s, background-color 0.3s, color 0.3s;
      color: #1a1a1a;
    }
    body.dark textarea {
      background-color: #2b2b2b;
      border-color: #444;
      color: #eaeaea;
      box-shadow: inset 0 0 6px rgba(255,255,255,0.1);
    }

    textarea:focus {
      border-color: #007bff;
      outline: none;
      background-color: #fdfdfd;
      box-shadow: 0 0 5px rgba(0,123,255,0.3);
    }

    body.dark textarea:focus {
      background-color: #3a3a3a;
    }

    button {
      margin: 10px 8px 0 0;
      padding: 12px 24px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
    }

    button:hover {
      background-color: #0056b3;
      transform: translateY(-1px);
    }

    body.dark button {
      background-color: #0d6efd;
    }

    body.dark button:hover {
      background-color: #0b5ed7;
    }

    pre {
      background-color: #1e1e1e;
      color: #d4d4d4;
      padding: 18px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-size: 15px;
      overflow-x: auto;
      line-height: 1.6;
      box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
      transition: background-color 0.3s, color 0.3s;
      max-width: 800px;
    }

    body.dark pre {
      background-color: #2b2b2b;
      color: #eaeaea;
      box-shadow: inset 0 0 6px rgba(255,255,255,0.1);
    }

    #history {
      max-height: 220px;
      overflow-y: auto;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      background-color: #fafafa;
      color: #444;
      max-width: 800px;
    }

    body.dark #history {
      background-color: #2b2b2b;
      border-color: #444;
      color: #ccc;
    }

    .history-item {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      font-family: monospace;
    }

    body.dark .history-item {
      border-color: #555;
    }

    .history-meta {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }

    body.dark .history-meta {
      color: #aaa;
    }

    ::selection {
      background: #007bff;
      color: white;
    }

    @media (max-width: 600px) {
      .container {
        padding: 0 10px;
      }

      textarea {
        height: 140px;
      }

      button {
        width: 100%;
        margin-bottom: 10px;
      }

      pre, #history {
        width: 100%;
      }
    }
  </style>
</head>
<body class="light">

<div class="container">
  <div style="text-align: right; margin-bottom: 20px;">
    <label>
      ‚óë Dark Mode
      <input type="checkbox" id="toggleMode" onchange="toggleMode()" style="transform: scale(1.2); margin-left: 8px;">
    </label>
  </div>

  <h1>üñ•Ô∏è ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶á‡¶≤‡¶æ‡¶∞</h1>

  <label for="banglaCode">‚úçÔ∏è ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ C ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:</label>
  <textarea id="banglaCode" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶≠‡¶æ‡¶∑‡¶æ‡¶Ø‡¶º C ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>

  <label for="userInput">üì• ‡¶á‡¶®‡¶™‡ßÅ‡¶ü (‡¶Ø‡¶¶‡¶ø ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶π‡¶Ø‡¶º):</label>
  <textarea id="userInput" placeholder="‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¶‡¶ø‡¶® (‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶°‡ßá ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶® ‡¶π‡¶Ø‡¶º)"></textarea>

  <div>
    <button onclick="runBanglaCCode()">‚ñ∂Ô∏è ‡¶∞‡¶æ‡¶® ‡¶ï‡¶∞‡ßã</button>
    <button onclick="clearAll()">üßπ ‡¶™‡¶∞‡¶ø‡¶∑‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã</button>
    <button onclick="saveCode()">üíæ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßã</button>
    <button onclick="loadCode()">üìÇ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßã</button>
    <button onclick="exportCCode()">üì§ Export .c</button>
  </div>

  <h3>üì§ ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü:</h3>
  <pre id="output">‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶Ü‡¶∏‡¶¨‡ßá...</pre>

  <h3>üîé ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶§ C ‡¶ï‡ßã‡¶°:</h3>
  <pre id="debug">...</pre>

  <h3>üìú ‡¶∞‡¶æ‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø:</h3>
  <div id="history"></div>
  <div style="margin-top: 10px;">
    <button onclick="clearHistory()">üßπ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßã</button>
  </div>
</div>

<script>
  function toggleMode() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  const mapC = {
    "‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü_‡¶¶‡¶æ‡¶ì": "printf",
    "‡¶á‡¶®‡¶™‡ßÅ‡¶ü_‡¶®‡¶æ‡¶ì": "scanf",
    "‡¶Ø‡¶¶‡¶ø": "if",
    "‡¶®‡¶æ‡¶π‡¶≤‡ßá": "else",
    "‡¶ú‡¶®‡ßç‡¶Ø": "for",
    "‡¶Ø‡¶§‡¶ï‡ßç‡¶∑‡¶£": "while",
    "‡¶´‡¶æ‡¶Ç‡¶∂‡¶®": "void",
    "‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶¨‡¶∞‡ßç‡¶§‡¶®": "return",
    "‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ": "int",
    "‡¶≠‡¶ó‡ßç‡¶®‡¶æ‡¶Ç‡¶∂": "float",
    "‡¶ö‡¶∞": "char",
    "‡¶Æ‡ßÇ‡¶≤": "main",
    "‡¶∏‡¶Æ‡¶æ‡¶®": "==",
    "‡¶®‡¶æ_‡¶∏‡¶Æ‡¶æ‡¶®": "!=",
    "‡¶¨‡¶°‡¶º": ">",
    "‡¶õ‡ßã‡¶ü": "<",
    "‡¶è‡¶¨‡¶Ç": "&&",
    "‡¶Ö‡¶•‡¶¨‡¶æ": "||"
  };

  const banglaDigits = {
    "‡ß¶": "0", "‡ßß": "1", "‡ß®": "2", "‡ß©": "3", "‡ß™": "4",
    "‡ß´": "5", "‡ß¨": "6", "‡ß≠": "7", "‡ßÆ": "8", "‡ßØ": "9"
  };

  const englishToBanglaDigits = {
    "0": "‡ß¶", "1": "‡ßß", "2": "‡ß®", "3": "‡ß©", "4": "‡ß™",
    "5": "‡ß´", "6": "‡ß¨", "7": "‡ß≠", "8": "‡ßÆ", "9": "‡ßØ"
  };

  const banglaToEnglishText = {
    "‡¶´‡¶≤‡¶æ‡¶´‡¶≤": "Result",
    "‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ": "Number",
    "‡¶Ø‡ßã‡¶ó‡¶´‡¶≤": "Sum",
    "‡¶®‡¶æ‡¶Æ": "Name",
    "‡¶á‡¶®‡¶™‡ßÅ‡¶ü": "Input",
    "‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü": "Output"
  };

  function convertBanglaDigitsToEnglish(text) {
    return text.replace(/[‡ß¶-‡ßØ]/g, d => banglaDigits[d] || d);
  }

  function convertEnglishDigitsToBangla(text) {
    return text.replace(/\d/g, d => englishToBanglaDigits[d] || d);
  }

  function replaceOperators(text) {
    const keysSorted = Object.keys(mapC).sort((a, b) => b.length - a.length);
    for (const key of keysSorted) {
      const re = new RegExp(`(?<!\\w)${key}(?!\\w)`, 'g');
      text = text.replace(re, mapC[key]);
    }
    return text;
  }

  function translateBanglaToC(code) {
    let lines = code.split('\n');
    let cCode = `#include <stdio.h>\nint main() {\n`;
    for (let line of lines) {
      line = convertBanglaDigitsToEnglish(line);
      line = replaceOperators(line);
      cCode += "  " + line + "\n";
    }
    cCode += "  return 0;\n}";
    return cCode;
  }

  function addToHistory(code, duration) {
    const div = document.createElement("div");
    div.className = "history-item";
    const now = new Date();
    const time = now.toLocaleTimeString('bn-BD');
    div.innerHTML = `<strong>‚è±Ô∏è ${time}</strong> (${duration} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∞‡¶æ‡¶®)<div class="history-meta">${code.replace(/\n/g, '<br>')}</div>`;
    document.getElementById("history").prepend(div);
  }

  async function runBanglaCCode() {
    const banglaCode = document.getElementById("banglaCode").value.trim();
    const userInputRaw = document.getElementById("userInput").value;
    const userInput = convertBanglaDigitsToEnglish(userInputRaw);

    if (!banglaCode) {
      alert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§");
      return;
    }

    const translatedCode = translateBanglaToC(banglaCode);
    document.getElementById("debug").textContent = translatedCode;
    document.getElementById("output").textContent = "‚è≥ ‡¶∞‡¶æ‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

    try {
      const startTime = performance.now();

      const res = await fetch("https://emkc.org/api/v2/piston/execute", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          language: "c",
          version: "10.2.0",
          files: [{ name: "main.c", content: translatedCode }],
          stdin: userInput
        })
      });

      const data = await res.json();
      const endTime = performance.now();
      const duration = ((endTime - startTime) / 1000).toFixed(2);

      let rawOutput = data.run?.stdout || data.run?.stderr || "‚ö†Ô∏è ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§";

      rawOutput = convertEnglishDigitsToBangla(rawOutput);

      for (const bnWord in banglaToEnglishText) {
        const enWord = banglaToEnglishText[bnWord];
        const re = new RegExp(enWord, "g");
        rawOutput = rawOutput.replace(re, bnWord);
      }

      document.getElementById("output").textContent = rawOutput.trim();
      addToHistory(banglaCode, duration);

    } catch (err) {
      document.getElementById("output").textContent = "‚ùå ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø: " + err.message;
    }
  }

  function clearAll() {
    document.getElementById("banglaCode").value = "";
    document.getElementById("userInput").value = "";
    document.getElementById("output").textContent = "‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶Ü‡¶∏‡¶¨‡ßá...";
    document.getElementById("debug").textContent = "...";
  }

  function clearHistory() {
    document.getElementById("history").innerHTML = "";
  }

  function saveCode() {
    const code = document.getElementById("banglaCode").value;
    if (!code.trim()) {
      alert("‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");
      return;
    }
    localStorage.setItem("banglaCCode", code);
    alert("‡¶ï‡ßã‡¶° ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
  }

  function loadCode() {
    const savedCode = localStorage.getItem("banglaCCode");
    if (!savedCode) {
      alert("‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶ï‡ßã‡¶° ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!");
      return;
    }
    document.getElementById("banglaCode").value = savedCode;
    alert("‡¶ï‡ßã‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
  }

  function exportCCode() {
    const cCode = document.getElementById("debug").textContent;
    if (!cCode || cCode === "..." || cCode.trim() === "") {
      alert("‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶§ C ‡¶ï‡ßã‡¶° ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø!");
      return;
    }
    const blob = new Blob([cCode], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "translated_code.c";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>
</body>
</html>