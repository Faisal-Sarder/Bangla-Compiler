<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶á‡¶≤‡¶æ‡¶∞</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans Bengali', sans-serif;
      padding: 40px 20px;
      max-width: 960px;
      margin: auto;
      border-radius: 10px;
      transition: background 0.3s, color 0.3s;
    }
    body.light {
      background: #f4f6f9;
      color: #1a1a1a;
    }
    body.dark {
      background: #1a1a1a;
      color: #eaeaea;
    }
    h1 { font-size: 32px; margin-bottom: 10px; }
    h3 {
      font-size: 20px;
      margin-top: 30px;
      margin-bottom: 10px;
      border-left: 4px solid #007bff;
      padding-left: 10px;
    }
    label { font-weight: bold; display: block; margin-top: 25px; font-size: 17px; }
    textarea {
      width: 100%; height: 160px; font-size: 15px;
      margin-top: 8px; padding: 12px 15px;
      border: 1px solid #ccc; border-radius: 8px;
      background-color: #fff; resize: vertical;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    textarea:hover {
      border-color: #007bff;
      background-color: #fdfdfd;
      box-shadow: 0 0 5px rgba(0,123,255,0.2);
    }
    button {
      margin: 10px 8px 0 0; padding: 12px 24px;
      background-color: #007bff; color: #fff;
      border: none; border-radius: 8px;
      font-size: 15px; font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
    }
    button:hover {
      background-color: #0056b3; transform: translateY(-1px);
    }
    pre {
      background-color: #1e1e1e; color: #d4d4d4;
      padding: 18px; border-radius: 8px;
      white-space: pre-wrap; font-size: 15px;
      overflow-x: auto; line-height: 1.6;
      box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
    }
    #history {
      max-height: 220px; overflow-y: auto;
      border: 1px solid #ccc; padding: 10px;
      border-radius: 8px; margin-top: 10px;
      background-color: #fafafa;
    }
    .history-item {
      padding: 8px;
      color: #888;
      border-bottom: 1px solid #ddd;
      font-family: monospace;
    }
    .history-meta {
      font-size: 13px;
      color: #888;
      margin-top: 4px;
    }
  </style>
</head>
<body class="light">
  <div style="text-align:right; margin-bottom:20px;">
    <label>
      ‚óë Dark Mode
      <input type="checkbox" id="toggleMode" onchange="toggleMode()" style="transform:scale(1.2); margin-left:8px">
    </label>
  </div>
  <h1>üñ•Ô∏è ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶ï‡¶Æ‡ßç‡¶™‡¶æ‡¶á‡¶≤‡¶æ‡¶∞</h1>

  <label>‚úçÔ∏è ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ C ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:</label>
  <textarea id="banglaCode" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ C ‡¶™‡ßç‡¶∞‡ßã‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ‡¶ø‡¶Ç ‡¶ï‡ßã‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>

  <label>üì• ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶¶‡¶ø‡¶® (‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá):</label>
  <textarea id="userInput" placeholder="‡¶Ø‡¶¶‡¶ø ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶•‡¶æ‡¶ï‡ßá, ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶®..."></textarea>

  <div>
    <button onclick="runBanglaCCode()">‚ñ∂Ô∏è ‡¶∞‡¶æ‡¶® ‡¶ï‡¶∞‡ßã</button>
    <button onclick="clearAll()">üßπ ‡¶™‡¶∞‡¶ø‡¶∏‡ßç‡¶ï‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã</button>
    <button onclick="saveCode()">üíæ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßã</button>
    <button onclick="loadCode()">üìÇ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßã</button>
    <button onclick="exportCCode()">üì§ Export .c</button>
  </div>

  <h3>üì§ ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü:</h3>
  <pre id="output">‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶Ü‡¶∏‡¶¨‡ßá...</pre>

  <h3>üîç Live C ‡¶ï‡ßã‡¶° Preview:</h3>
  <pre id="debug">...</pre>

  <h3>üìú ‡¶∞‡¶æ‡¶® ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø:</h3>
  <div id="history"></div>
  <div style="margin-top: 10px;">
    <button onclick="clearHistory()">üßπ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßã</button>
  </div>

  <script>
    const mapC = {"‡¶≤‡¶ø‡¶ñ‡ßã":"printf","‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ_‡¶®‡¶æ‡¶ì":"scanf","‡¶Ø‡¶¶‡¶ø":"if","‡¶®‡¶æ‡¶π‡¶≤‡ßá":"else","‡¶ú‡¶®‡ßç‡¶Ø":"for","‡¶Ø‡¶§‡¶ï‡ßç‡¶∑‡¶£":"while","‡¶´‡¶æ‡¶Ç‡¶∂‡¶®":"void","‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶¨‡¶∞‡ßç‡¶§‡¶®":"return","‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ":"int","‡¶≠‡¶ó‡ßç‡¶®‡¶æ‡¶Ç‡¶∂":"float","‡¶ö‡¶∞":"char","‡¶Æ‡ßÇ‡¶≤":"main","‡¶∏‡¶Æ‡¶æ‡¶®":"==","‡¶®‡¶æ_‡¶∏‡¶Æ‡¶æ‡¶®":"!=","‡¶¨‡¶°‡¶º":">","‡¶õ‡ßã‡¶ü":"<","‡¶è‡¶¨‡¶Ç":"&&","‡¶Ö‡¶•‡¶¨‡¶æ":"||"};
    const bnToEnDigits = {"‡ß¶":"0","‡ßß":"1","‡ß®":"2","‡ß©":"3","‡ß™":"4","‡ß´":"5","‡ß¨":"6","‡ß≠":"7","‡ßÆ":"8","‡ßØ":"9"};
    const enToBnDigits = {"0":"‡ß¶","1":"‡ßß","2":"‡ß®","3":"‡ß©","4":"‡ß™","5":"‡ß´","6":"‡ß¨","7":"‡ß≠","8":"‡ßÆ","9":"‡ßØ"};
    const textMap = {"‡¶´‡¶≤‡¶æ‡¶´‡¶≤":"Result","‡¶®‡¶æ‡¶Æ":"Name","‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü":"Output","‡¶á‡¶®‡¶™‡ßÅ‡¶ü":"Input"};

    function convertBanglaDigitsToEnglish(text) {
      return text.replace(/[‡ß¶-‡ßØ]/g, d => bnToEnDigits[d] || d);
    }
    function convertEnglishDigitsToBangla(text) {
      return text.replace(/[0-9]/g, d => enToBnDigits[d] || d);
    }
    function replaceOperators(text) {
      const keys = Object.keys(mapC).sort((a,b) => b.length - a.length);
      for (let key of keys) {
        let re = new RegExp(`(?<!\\w)${key}(?!\\w)`, 'g');
        text = text.replace(re, mapC[key]);
      }
      return text;
    }
    function translateBanglaToC(code) {
      let lines = code.split('\n');
      let result = '#include <stdio.h>\nint main() {\n';
      for (let line of lines) {
        line = convertBanglaDigitsToEnglish(line);
        line = replaceOperators(line);
        line = line.replace(/"(.*?)"/g, (m, p1) => {
          for (let key in textMap) {
            p1 = p1.replace(new RegExp(key, 'g'), textMap[key]);
          }
          return `"${p1}"`;
        });
        result += '  ' + line + '\n';
      }
      return result + '  return 0;\n}';
    }

    function runBanglaCCode() {
      const code = document.getElementById("banglaCode").value;
      const input = convertBanglaDigitsToEnglish(document.getElementById("userInput").value);
      const cCode = translateBanglaToC(code);
      const startTime = Date.now();
      document.getElementById("debug").textContent = cCode;
      document.getElementById("output").textContent = "‚è≥ ‡¶∞‡¶æ‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

      fetch("https://emkc.org/api/v2/piston/execute", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          language: "c",
          version: "10.2.0",
          files: [{ name: "main.c", content: cCode }],
          stdin: input
        })
      })
      .then(res => res.json())
      .then(data => {
        const endTime = Date.now();
        const duration = ((endTime - startTime) / 1000).toFixed(2);
        let raw = data.run?.stdout || data.run?.stderr || "‚ö†Ô∏è ‡¶ï‡ßã‡¶®‡ßã ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§";
        let final = convertEnglishDigitsToBangla(raw);
        for (let key in textMap) {
          final = final.replace(new RegExp(textMap[key], 'g'), key);
        }
        document.getElementById("output").textContent = final.trim();
        addToHistory(code, duration);
      });
    }

    function addToHistory(code, duration) {
      const div = document.createElement("div");
      div.className = "history-item";
      const now = new Date();
      const time = now.toLocaleTimeString('bn-BD');
      div.innerHTML = `<strong>‚è±Ô∏è ${time}</strong> (${duration} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∞‡¶æ‡¶®)<div class="history-meta">${code.replace(/\n/g, '<br>')}</div>`;
      document.getElementById("history").prepend(div);
    }

    function clearAll() {
      document.getElementById("banglaCode").value = "";
      document.getElementById("userInput").value = "";
      document.getElementById("output").textContent = "‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶Ü‡¶∏‡¶¨‡ßá...";
      document.getElementById("debug").textContent = "...";
    }

    function clearHistory() {
      document.getElementById("history").innerHTML = "";
    }

    function toggleMode() {
      document.body.classList.toggle("dark");
      document.body.classList.toggle("light");
    }
  </script>
</body>
</html>
